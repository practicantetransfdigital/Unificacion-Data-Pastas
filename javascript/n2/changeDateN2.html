<script>

    function showChangeDateModal(reportId, currentDate) {
        const existingModal = document.getElementById('dateModal');
        if (existingModal) existingModal.remove();

        const overlay = document.createElement('div');
        overlay.id = 'dateModal';
        overlay.style.cssText = `
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
    display: flex; align-items: center; justify-content: center;
    z-index: 10000;
  `;

        const modal = document.createElement('div');
        modal.style.cssText = `
    background: #fff; padding: 1.5rem;
    border-radius: 16px; width: 90%; max-width: 400px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    display: flex; flex-direction: column; gap: 1rem;
  `;

        modal.innerHTML = `
    <h2 style="text-align:center; color:#1e293b; font-size:18px; font-weight:600;">
      ðŸ“… Cambiar Fecha de SoluciÃ³n
    </h2>

    <label for="newDate" style="font-weight:500; color:#475569;">Nueva Fecha:</label>
    <input type="date" id="newDate" value="${currentDate ? formatLocalDateForInput(currentDate) : ''}" 
      style="width:100%; padding:0.6rem 0.8rem; border:1px solid #cbd5e1; border-radius:8px; font-size:14px;">

    <div style="display:flex; justify-content:flex-end; gap:0.75rem; margin-top:1rem;">
      <button id="cancelDate" 
        style="padding:0.5rem 1rem; border:1px solid #cbd5e1; border-radius:8px; cursor:pointer;">
        Cancelar
      </button>
      <button id="saveDate" 
        style="padding:0.5rem 1rem; border:none; background:#3b82f6; color:#fff; border-radius:8px; cursor:pointer;">
        Guardar
      </button>
    </div>
  `;

        overlay.appendChild(modal);
        document.body.appendChild(overlay);

        const dateInput = modal.querySelector('#newDate');
        const saveBtn = modal.querySelector('#saveDate');

        // BotÃ³n cancelar
        modal.querySelector('#cancelDate').addEventListener('click', () => overlay.remove());

        // Guardar
        saveBtn.addEventListener('click', () => {
            const newDate = dateInput.value.trim();
            if (!newDate) {
                showAlert('warning', 'Campo vacÃ­o', 'Debes seleccionar una fecha');
                return;
            }

            overlay.remove();
            showAlert('info', 'Actualizando...', 'Modificando fecha de soluciÃ³n...', 2000);

            google.script.run
                .withSuccessHandler(() => {
                    showAlert('success', 'Ã‰xito', 'Fecha actualizada correctamente');
                    loadN2Reports(); // recargar lista
                })
                .withFailureHandler(err => {
                    console.error(err);
                    showAlert('error', 'Error', 'No se pudo actualizar la fecha');
                })
                .updateReportDate(reportId, newDate);
        });

        overlay.addEventListener('click', e => {
            if (e.target === overlay) overlay.remove();
        });
    }

    function formatLocalDateForInput(dateString) {
        const date = new Date(dateString);
        // Ajusta a la zona local, sin UTC shift
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

</script>